{% extends "base.html" %}
{% block title %}AI PDF Summarizer - BlinkPDF{% endblock %}
{% block seo_desc %}Summarize any PDF file into short, clear notes instantly using AI.{% endblock %}

{% block content %}
<section class="max-w-7xl mx-auto px-4 py-10">

  <h1 class="text-3xl font-bold mb-2 text-slate-900 dark:text-white">
    AI PDF Summarizer
  </h1>

  <p class="text-sm text-slate-500 mb-6 max-w-xl">
    Upload your PDF and get a smart AI-generated summary instantly.
  </p>

  <!-- Upload Area -->
  <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow border border-slate-200 dark:border-slate-700 mb-6">
    <form id="summaryForm" class="flex flex-col sm:flex-row gap-4 items-center">
      <input type="file" id="pdfFile" accept=".pdf"
        class="border border-slate-300 dark:border-slate-700 rounded px-3 py-2 text-sm w-full sm:w-auto bg-white dark:bg-slate-900"
        required>

      <button type="submit"
        class="bg-violet-600 hover:bg-violet-700 text-white px-6 py-2 rounded font-medium text-sm">
        Generate Summary
      </button>
    </form>

    <p id="status" class="text-xs mt-2 text-slate-500"></p>
  </div>

  <!-- Summary Output -->
  <div id="resultBox"
    class="hidden bg-white dark:bg-slate-800 p-6 rounded-xl shadow border border-slate-200 dark:border-slate-700">

    <div class="flex justify-between items-center mb-3">
      <h3 class="font-semibold text-lg text-slate-900 dark:text-white">Summary</h3>
      <button onclick="downloadSummary()"
        class="text-xs bg-slate-200 dark:bg-slate-700 px-3 py-1 rounded">
        Download .txt
      </button>
    </div>

    <textarea id="result"
      class="w-full border rounded p-3 text-sm min-h-[200px] bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-white"></textarea>
  </div>

</section>


<!-- ============== RANDOM TOOLS SECTION ============== -->
<section class="max-w-7xl mx-auto mt-16 px-4">
  <h2 class="text-xl font-bold mb-5 text-slate-900 dark:text-slate-100">
    Try More Tools
  </h2>

  <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4">

    {% for tool in random_tools %}
      <a href="{{ url_for('tool_page', slug=tool.slug) }}"
        class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl p-4 shadow-sm hover:shadow-lg transition">

        <img src="{{ url_for('static', filename='icons/' ~ tool.icon) }}"
          class="h-10 w-10 mb-2">

        <h4 class="font-semibold text-sm mb-1">{{ tool.title }}</h4>
        <p class="text-xs text-slate-500">{{ tool.desc }}</p>
      </a>
    {% endfor %}

  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  const form = document.getElementById("summaryForm");
  const resultBox = document.getElementById("resultBox");
  const result = document.getElementById("result");
  const status = document.getElementById("status");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const fileInput = document.getElementById("pdfFile");
    const file = fileInput.files[0];

    if (!file) {
      alert("Please upload a PDF file");
      return;
    }

    const formData = new FormData();
    formData.append("file", file);

    status.innerText = "Processing... Please wait ⏳";
    resultBox.classList.add("hidden");
    result.value = "";

    try {
      const res = await fetch("/ai/summarizer", {
        method: "POST",
        body: formData
      });

      const data = await res.json();

      if (data.summary) {
        result.value = data.summary;
        resultBox.classList.remove("hidden");
        status.innerText = "Summary generated successfully ✅";
      } else {
        status.innerText = "Failed to summarize document ❌";
      }

    } catch (err) {
      console.error(err);
      status.innerText = "Server error while summarizing ❌";
    }
  });

  /* DOWNLOAD SUMMARY */
  function downloadSummary() {
    const text = result.value;
    if (!text.trim()) return;

    const blob = new Blob([text], { type: "text/plain" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "BlinkPDF-Summary.txt";
    a.click();

    URL.revokeObjectURL(url);
  }
</script>
{% endblock %}

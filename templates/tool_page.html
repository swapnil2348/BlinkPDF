{% extends "base.html" %}

{% block title %}{{ tool.title }} — BlinkPDF{% endblock %}
{% block meta %}{{ tool.desc }} Online with BlinkPDF tools{% endblock %}

{% block content %}

<section class="bg-gradient-to-b from-violet-100 to-transparent rounded-2xl p-6 mb-6 shadow-sm">
  <h1 class="text-3xl font-extrabold tracking-tight text-gray-900 flex items-center gap-3">
    <img src="{{ url_for('static', filename='icons/' + tool.icon) }}" class="h-10 w-10">
    {{ tool.title }}
  </h1>
  <p class="text-gray-600 max-w-2xl mt-2">{{ tool.desc }}</p>
</section>

<form method="POST"
      action="{{ url_for('process', slug=tool.slug) }}"
      enctype="multipart/form-data"
      class="bg-white rounded-2xl border shadow-md p-6 space-y-6">

  <!-- FILE UPLOAD -->
  <div>
    <label class="font-semibold block mb-2">Upload File(s)</label>

    <input type="file"
           id="fileInput"
           name="file"
           multiple
           required
           class="hidden">

    <div id="dropZone"
         class="w-full border-2 border-dashed border-violet-300 p-8 rounded-xl bg-violet-50 text-center cursor-pointer">
      Click or Drop files here
    </div>

    <!-- PREVIEW + DRAG AREA -->
    <ul id="fileList" class="mt-4 space-y-2"></ul>

    <p class="text-xs text-gray-500 mt-2">
      Drag files up or down to rearrange the order before processing
    </p>
  </div>

  <!-- SIGN TOOL -->
  {% if tool.slug == "sign-pdf" %}
  <div class="p-4 bg-gray-50 rounded-xl border">
    <h3 class="font-semibold text-sm mb-3">Add Signature</h3>
    <input type="file" name="signature" class="border p-2 rounded w-full mb-2">
    <input type="text" name="text" placeholder="Type name (optional)"
           class="border p-2 rounded w-full">
    <div class="flex gap-2 mt-2">
      <input type="number" name="x" placeholder="X" class="border p-2 rounded w-24">
      <input type="number" name="y" placeholder="Y" class="border p-2 rounded w-24">
      <input type="number" name="size" placeholder="Size" class="border p-2 rounded w-24">
    </div>
  </div>
  {% endif %}

  <!-- WATERMARK TOOL -->
  {% if tool.slug == "watermark-pdf" %}
  <div class="p-4 bg-gray-50 rounded-xl border">
    <h3 class="font-semibold text-sm mb-3">Watermark Options</h3>
    <input type="file" name="logo" class="border p-2 rounded w-full mb-3">
    <input type="text" name="text"
           placeholder="Watermark text"
           class="border p-2 rounded w-full mb-2">
    <div class="flex gap-2">
      <input type="number" name="x" placeholder="X" class="border p-2 rounded w-24">
      <input type="number" name="y" placeholder="Y" class="border p-2 rounded w-24">
      <input type="number" name="size" placeholder="Size" class="border p-2 rounded w-24">
    </div>
  </div>
  {% endif %}

  <!-- NUMBER PAGES TOOL -->
  {% if tool.slug == "number-pdf" %}
  <div class="p-4 bg-gray-50 rounded-xl border">
    <h3 class="font-semibold text-sm mb-3">Number Settings</h3>

    <select name="position" class="border rounded p-2 w-full">
      <option value="top-left">Top Left</option>
      <option value="top-right">Top Right</option>
      <option value="bottom-left">Bottom Left</option>
      <option value="bottom-right">Bottom Right</option>
    </select>

    <input type="number" name="size" placeholder="Font Size"
           class="border p-2 rounded w-full mt-2">
  </div>
  {% endif %}

  <!-- CROP / RESIZE -->
  {% if tool.slug in ["crop-pdf","resize-pdf"] %}
  <div class="p-4 bg-gray-50 rounded-xl border grid grid-cols-2 gap-2">
    <input type="number" name="width" placeholder="Width" class="border p-2 rounded">
    <input type="number" name="height" placeholder="Height" class="border p-2 rounded">
  </div>
  {% endif %}
  
  <!-- ======================== NEW ADVANCED OPTIONS ======================== -->

<!-- COMPRESS PDF -->
{% if tool.slug == "compress-pdf" %}
<div class="p-4 bg-gray-50 rounded-xl border">
  <h3 class="font-semibold text-sm mb-3">Compression Level</h3>
  <select name="level" class="border p-2 rounded w-full">
    <option value="low">Low (Best Quality)</option>
    <option value="medium">Medium (Balanced)</option>
    <option value="high">High (Smallest Size)</option>
  </select>
</div>
{% endif %}

<!-- OPTIMIZE PDF -->
{% if tool.slug == "optimize-pdf" %}
<div class="p-4 bg-gray-50 rounded-xl border">
  <h3 class="font-semibold text-sm mb-3">Optimization Options</h3>
  <label><input type="checkbox" name="clean_metadata"> Remove Metadata</label><br>
  <label><input type="checkbox" name="compress_images"> Compress Images</label><br>
  <label><input type="checkbox" name="remove_blank_pages"> Remove Blank Pages</label>
</div>
{% endif %}

<!-- ROTATE PDF -->
{% if tool.slug == "rotate-pdf" %}
<div class="p-4 bg-gray-50 rounded-xl border">
  <h3 class="font-semibold text-sm mb-3">Rotate Pages</h3>
  <select name="angle" class="border p-2 rounded w-full">
    <option value="90">90° Right</option>
    <option value="180">180°</option>
    <option value="270">270° Left</option>
  </select>
</div>
{% endif %}

<!-- PROTECT PDF -->
{% if tool.slug == "protect-pdf" %}
<div class="p-4 bg-gray-50 rounded-xl border">
  <h3 class="font-semibold text-sm mb-2">Set Password</h3>
  <input type="password" name="password" placeholder="Enter password"
         class="border p-2 rounded w-full">
</div>
{% endif %}

<!-- UNLOCK PDF -->
{% if tool.slug == "unlock-pdf" %}
<div class="p-4 bg-gray-50 rounded-xl border">
  <h3 class="font-semibold text-sm mb-2">Enter Current Password</h3>
  <input type="password" name="password" placeholder="Current PDF Password"
         class="border p-2 rounded w-full">
</div>
{% endif %}

<!-- OCR PDF -->
{% if tool.slug == "ocr-pdf" %}
<div class="p-4 bg-gray-50 rounded-xl border">
  <h3 class="font-semibold text-sm mb-2">OCR Options</h3>
  <select name="language" class="border p-2 rounded w-full">
    <option value="eng">English</option>
    <option value="spa">Spanish</option>
    <option value="fra">French</option>
    <option value="hin">Hindi</option>
  </select>
</div>
{% endif %}

<!-- EXTRACT TEXT -->
{% if tool.slug == "extract-text" %}
<div class="p-4 bg-gray-50 rounded-xl border">
  <h3 class="font-semibold text-sm mb-2">Extraction Mode</h3>
  <label><input type="radio" name="mode" value="text" checked> Text Only</label><br>
  <label><input type="radio" name="mode" value="ocr"> OCR + Text</label>
</div>
{% endif %}

<!-- EXTRACT IMAGES -->
{% if tool.slug == "extract-images" %}
<div class="p-4 bg-gray-50 rounded-xl border">
  <h3 class="font-semibold text-sm mb-2">Image Format</h3>
  <select name="format" class="border p-2 rounded w-full">
    <option value="png">PNG</option>
    <option value="jpg">JPG</option>
  </select>
</div>
{% endif %}

  <!-- PROCESS BUTTON -->
  <div class="flex justify-end">
    <button class="bg-violet-600 hover:bg-violet-700 text-white font-semibold px-8 py-3 rounded-xl shadow-lg transition">
      Process {{ tool.title }}
    </button>
  </div>
</form>

<!-- ABOUT TOOL FOR SEO -->
<div class="mt-10 max-w-4xl text-sm text-gray-600 leading-relaxed">
  <h2 class="text-lg font-bold text-gray-900 mb-2">About {{ tool.title }}</h2>
  <p>
    {{ tool.title }} helps you to {{ tool.desc|lower }}. With BlinkPDF you can use this tool
    directly in your browser without installing any software. All processing is secure.
  </p>
</div>

<!-- SUGGESTED TOOLS -->
<div class="mt-12">
  <h2 class="text-xl font-bold mb-4">Try more PDF & AI Tools</h2>
  <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4">
    {% for t in random_tools %}
    <a href="{{ t.url if t.url else url_for('tool_page', slug=t.slug) }}"
       class="bg-white border rounded-xl p-3 shadow-sm hover:shadow-md text-center transition">
      <img src="{{ url_for('static', filename='icons/' + t.icon) }}"
           class="h-8 mx-auto mb-2">
      <span class="text-xs font-semibold text-gray-800">{{ t.title }}</span>
    </a>
    {% endfor %}
  </div>
</div>

<!-- SORTABLE JS -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<script>
const fileInput = document.getElementById("fileInput");
const dropZone = document.getElementById("dropZone");
const fileList = document.getElementById("fileList");
let filesArray = [];

dropZone.onclick = () => fileInput.click();

fileInput.onchange = (e) => {
  for (let file of e.target.files) {
    filesArray.push(file);
  }
  renderFiles();
};

dropZone.ondragover = e => {
  e.preventDefault();
  dropZone.classList.add("bg-violet-200");
};
dropZone.ondragleave = e => {
  dropZone.classList.remove("bg-violet-200");
};

dropZone.ondrop = e => {
  e.preventDefault();
  dropZone.classList.remove("bg-violet-200");
  for (let file of e.dataTransfer.files) {
    filesArray.push(file);
  }
  renderFiles();
};

function renderFiles(){
  fileList.innerHTML = "";
  filesArray.forEach((f,i) => {
    const li = document.createElement("li");
    li.className = "bg-gray-100 p-2 rounded flex justify-between items-center cursor-move";
    li.innerHTML = `
      <span class="text-sm truncate">${f.name}</span>
      <button onclick="removeFile(${i})" type="button"
        class="text-red-600 font-bold">✕</button>
    `;
    fileList.appendChild(li);
  });

  Sortable.create(fileList,{
    animation:150,
    onEnd:function(evt){
      const moved = filesArray.splice(evt.oldIndex,1)[0];
      filesArray.splice(evt.newIndex,0,moved);
    }
  });

  setHiddenFiles();
}

function removeFile(i){
  filesArray.splice(i,1);
  renderFiles();
}

function setHiddenFiles(){
  const dt = new DataTransfer();
  filesArray.forEach(f=>dt.items.add(f));
  fileInput.files = dt.files;
}
</script>

{% endblock %}
